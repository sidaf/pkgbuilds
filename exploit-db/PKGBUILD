_pkgname='exploit-db'
pkgname="${_pkgname}-git"
pkgver=1286.21f7dd843
pkgrel=1
pkgdesc="The official Exploit Database repository"
url='https://github.com/offensive-security/exploit-database'
arch=('any')
license=('GPL')
depends=('bash')
makedepends=('git')
options=('!strip')
source=("${_pkgname}::git+https://github.com/offensive-security/exploit-database.git")
sha512sums=('SKIP')

pkgver() {
  cd "$srcdir/${_pkgname}"

  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

prepare() {
  cd "$srcdir/${_pkgname}"

  sed "s|gitpath=\"/opt/exploit-database\"|gitpath=\"/usr/share/${pkgname}\"|" -i searchsploit
}

package() {
  cd "$srcdir/${_pkgname}"

  install -d "${pkgdir}/usr/bin"
  install -d "${pkgdir}/usr/share/${pkgname}/platforms"
  cp -r platforms "${pkgdir}/usr/share/${pkgname}/platforms"
  install -Dm644 "README.md" "${pkgdir}/usr/share/${pkgname}/README.md"
  install -Dm644 "files.csv" "${pkgdir}/usr/share/${pkgname}/files.csv"
  install -Dm755 "searchsploit" "${pkgdir}/usr/bin/searchsploit"
}
